flowchart TB
  classDef process fill:#e0f7ff,stroke:#06b6d4,stroke-width:2px
  classDef store fill:#f1f5f9,stroke:#475569,stroke-width:2px
  classDef ext fill:#fef9c3,stroke:#ca8a04,stroke-width:2px

  User[Admin/Student]:::ext

  P1((Auth Guard & Routing)):::process
  P2((Profile/Role Resolver)):::process
  P3((RBAC Checks)):::process

  Auth[(Firebase Auth)]:::store
  DB[(Firestore: users, exams, submissions, results)]:::store

  User -- credentials --> P1
  P1 -- onAuthStateChanged --> Auth
  Auth -- session/user --> P1

  P1 -- users/{uid} --> P2
  P2 -- read role/admin flags --> DB
  P2 -- role, flags --> P1

  P1 -- route access check --> P3
  P3 -- permissions map --> P3
  P3 -- allow/deny --> P1

  P1 -- redirect (login/dashboard/student dashboard) --> User


